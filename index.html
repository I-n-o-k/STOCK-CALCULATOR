<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator dan Pembanding Stok (Realtime)</title>
    <link rel="stylesheet" href="style.css">
    <style>
      #conn-indicator {
        position: sticky; top: 0; z-index: 5;
        font-size: 12px; padding: 6px 10px; border-radius: 4px; 
        background: #eee; display: inline-block; margin: 6px 0;
      }
      #conn-indicator.ok { background: #d4edda; color: #155724; }
      #conn-indicator.bad { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>

<div class="container">
    <h2>Kalkulator Stok Paket Internet</h2>

    <div id="conn-indicator" class="bad">Realtime: terputus</div>

    <div style="margin-bottom: 20px;">
        <label for="provider-filter" style="font-weight: bold;">Filter Berdasarkan Provider:</label>
        <select id="provider-filter" onchange="filterProducts(this.value)" style="padding: 8px; border-radius: 4px; border: 1px solid #ccc; margin-left: 10px;">
            <option value="Semua">Semua Provider</option>
        </select>
    </div>

    <table>
        <thead>
            <tr>
                <th style="width: 20%;">Nama Paket</th>
                <th style="width: 12%;">Display Atas</th>
                <th style="width: 12%;">Display Bawah</th>
                <th style="width: 12%;">Display Belakang</th>
                <th style="width: 14%;">Total Stok (Hitung Fisik)</th>
                <th style="width: 14%;">Stok Komputer</th> 
                <th style="width: 8%;">Aksi</th>
            </tr>
        </thead>
        <tbody id="stock-body"></tbody>
        <tfoot>
            <tr class="total-row">
                <td colspan="4" style="text-align: right;" data-label="Grand Total Stok Fisik:">Grand Total Stok Fisik:</td>
                <td id="grand-total-fisik" data-label="Total Fisik">0</td>
                <td colspan="2"></td> 
            </tr>
        </tfoot>
    </table>
    
    <button id="tambah-btn" onclick="tambahBarang()">
        + Tambah Paket Manual
    </button>
    
    <h3 style="margin-top: 30px; border-bottom: 1px solid #ddd; padding-bottom: 5px;">Hasil Pembanding Stok (Selisih)</h3>
    <table id="selisih-table">
        <thead>
            <tr class="selisih-header">
                <th style="width: 70%; background-color: #333; color: white;">Nama Paket</th>
                <th style="width: 30%; background-color: #333; color: white;">Selisih Stok (Fisik - Komputer)</th>
            </tr>
        </thead>
        <tbody id="selisih-body"></tbody>
        <tfoot>
             <tr class="total-row">
                <td style="text-align: right; background-color: #f0f0f0;" data-label="Grand Total Selisih:">**Grand Total Selisih:**</td>
                <td id="grand-total-selisih" data-label="Grand Selisih:">0</td>
            </tr>
        </tfoot>
    </table>

</div>

<!-- Socket.IO client harus sebelum script.js -->
<script src="/socket.io/socket.io.js"></script>
<script src="script.js"></script>

<script>
  // kecil: hanya indikator status socket
  (function(){
    const el = document.getElementById('conn-indicator');
    function ok(){ el.textContent = 'Realtime: tersambung'; el.classList.remove('bad'); el.classList.add('ok'); }
    function bad(){ el.textContent = 'Realtime: terputus'; el.classList.remove('ok'); el.classList.add('bad'); }
    if (window.io) {
      const sock = io();
      sock.on('connect', ok);
      sock.on('disconnect', bad);
    }
  })();
</script>

</body>
</html>